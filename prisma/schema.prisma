generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model AuthProvider {
  id         Int      @id @default(autoincrement())
  provider   AuthType
  providerId String
  userId     Int
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerId])
  @@unique([userId, provider])
}

model User {
  id            Int            @id @default(autoincrement())
  name          String?
  email         String?        @unique
  password      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  authProviders AuthProvider[]
  blogs         Blog[]
}

model Blog {
  id               Int           @id @default(autoincrement())
  slug             String        @unique
  contentType      ContentType   @default(MARKDOWN)
  currentVersionId Int           @default(1)
  currentVersion   BlogVersion   @relation("CurrentVersion", fields: [currentVersionId], references: [id])
  authorId         Int
  status           BlogStatus    @default(DRAFT)
  isEnabled        Boolean       @default(true)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  publishedAt      DateTime?
  author           User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  versions         BlogVersion[] @relation("BlogToVersions")

  @@index([id])
}

model BlogVersion {
  id            Int      @id @default(autoincrement())
  versionNumber Int
  blogId        Int
  title         String
  content       String
  createdAt     DateTime @default(now())
  blog          Blog     @relation("BlogToVersions", fields: [blogId], references: [id], onDelete: Cascade)
  currentBlogs  Blog[]   @relation("CurrentVersion")

  @@unique([blogId, versionNumber])
  @@index([blogId])
}

enum AuthType {
  discord
  google
  x
}

enum ContentType {
  MARKDOWN
  JSON
}

enum BlogStatus {
  DRAFT
  PUBLISHED
}
